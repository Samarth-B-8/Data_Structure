#include <stdio.h> 
#include <ctype.h> 
#include <string.h> 
#define MAX 50 
/* Stack for characters */ 
struct stack1 { 
char data[MAX]; 
int top; 
}; 
/* Stack for integers */ 
struct stack2 { 
int data[MAX]; 
int top; 
}; 
/* ---------- Stack1 operations ---------- */ 
void init1(struct stack1 *s) { 
s->top = -1; 
} 
int empty1(struct stack1 *s) { 
return s->top == -1; 
} 
void push1(struct stack1 *s, char x) { 
s->data[++s->top] = x; 
} 
char pop1(struct stack1 *s) { 
if (empty1(s)) 
return '\0'; 
return s->data[s->top--]; 
} 
char peek1(struct stack1 *s) { 
if (empty1(s)) 
return '\0'; 
return s->data[s->top]; 
} 
/* ---------- Stack2 operations ---------- */ 
void init2(struct stack2 *s) { 
s->top = -1; 
} 
void push2(struct stack2 *s, int x) { 
s->data[++s->top] = x; 
} 
int pop2(struct stack2 *s) { 
if (s->top == -1) 
        return 0; 
    return s->data[s->top--]; 
} 
 
/* Operator precedence */ 
int priority(char op) { 
    if (op == '+' || op == '-') return 1; 
    if (op == '*' || op == '/') return 2; 
    return 0; 
} 
 
/* Reverse string */ 
void reverse(char exp[]) { 
    int i = 0, j = strlen(exp) - 1; 
    char temp; 
    while (i < j) { 
        temp = exp[i]; 
        exp[i] = exp[j]; 
        exp[j] = temp; 
        i++; 
        j--; 
    } 
} 
 
/* Infix to Prefix */ 
void infixToPrefix(char infix[], char prefix[]) { 
    struct stack1 s; 
    char postfix[MAX]; 
    int i = 0, j = 0; 
    char ch; 
 
    init1(&s); 
 
    reverse(infix); 
 
    /* Swap brackets */ 
    for (i = 0; infix[i] != '\0'; i++) { 
        if (infix[i] == '(') 
            infix[i] = ')'; 
        else if (infix[i] == ')') 
            infix[i] = '('; 
    } 
 
    i = 0; 
    while (infix[i] != '\0') { 
        ch = infix[i]; 
 
        if (isalnum(ch)) { 
            postfix[j++] = ch; 
        } 
        else if (ch == '(') { 
            push1(&s, ch); 
        } 
        else if (ch == ')') { 
            while (!empty1(&s) && peek1(&s) != '(') 
                postfix[j++] = pop1(&s); 
            pop1(&s); 
        } 
        else { 
            while (!empty1(&s) && priority(peek1(&s)) > priority(ch)) 
                postfix[j++] = pop1(&s); 
            push1(&s, ch); 
        } 
        i++; 
    } 
 
    while (!empty1(&s)) 
        postfix[j++] = pop1(&s); 
 
    postfix[j] = '\0'; 
 
    reverse(postfix); 
    strcpy(prefix, postfix); 
} 
 
/* Evaluate Prefix */ 
int evaluatePrefix(char prefix[]) { 
    struct stack2 s; 
    int i, a, b; 
 
    init2(&s); 
 
    for (i = strlen(prefix) - 1; i >= 0; i--) { 
        if (isdigit(prefix[i])) { 
            push2(&s, prefix[i] - '0'); 
        } else { 
            a = pop2(&s); 
            b = pop2(&s); 
 
            switch (prefix[i]) { 
                case '+': push2(&s, a + b); break; 
                case '-': push2(&s, a - b); break; 
                case '*': push2(&s, a * b); break; 
                case '/': push2(&s, a / b); break; 
            } 
        } 
    } 
 
    return pop2(&s); 
} 
 
/* ---------- Main ---------- */ 
int main() { 
    char infix[MAX], prefix[MAX]; 
    int choice, result; 
 
    /* Menu appears once */ 
    printf("1 Infix to Prefix\n"); 
    printf("2 Evaluate Prefix\n"); 
    printf("3 Exit\n"); 
 
    while (1) { 
        printf("Enter your choice: "); 
        scanf("%d", &choice); 
 
        if (choice == 1) { 
            printf("Enter infix expression: "); 
            scanf("%s", infix); 
            infixToPrefix(infix, prefix); 
            printf("Prefix expression: %s\n", prefix); 
        } 
        else if (choice == 2) { 
            printf("Enter prefix expression: "); 
            scanf("%s", prefix); 
            result = evaluatePrefix(prefix); 
            printf("Result: %d\n", result); 
        } 
        else if (choice == 3) { 
            return 0; 
        } 
    } 
}
